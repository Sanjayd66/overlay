<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BGMI PRO ADMIN - FULL CONTROL</title>
  <style>
    :root { --orange:#ff5a00; --blue:#0088ff; --green:#2ecc71; --red:#dc3545; --dark:#111; }
    body{margin:0;font-family:'Oswald',sans-serif;background:#050505;color:#fff;overflow-x:hidden;}
    #admin{padding:20px;}
    
    .header { background:#000; border-left:5px solid var(--orange); padding:15px; font-size:20px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center; }
    .status-msg { color: var(--green); font-weight: bold; }
    
    .top-controls { display:flex; gap:10px; margin-bottom:15px; }
    .btn { padding:10px 20px; border:none; border-radius:4px; color:#fff; font-weight:bold; cursor:pointer; text-transform:uppercase; font-size:12px; }
    
    .db-table { width:100%; border-collapse:collapse; background: var(--dark); border-radius: 8px; }
    .db-table th { background:#222; color:var(--orange); padding:10px; text-align:left; }
    .db-table td { padding:8px; border-bottom:1px solid #333; }
    .db-table input { background:#000; color:#fff; border:1px solid #444; width:90%; padding:6px; border-radius:4px; font-size:12px; }
    
    .manual-show { background:var(--blue); color:#fff; border:none; padding:10px; border-radius:4px; cursor:pointer; font-size:20px; width:100%; font-weight:bold; }
    
    /* Active/Deactive Toggle */
    .toggle-btn { padding:5px 10px; border-radius:4px; border:none; cursor:pointer; font-weight:bold; width:80px; }
    .active-on { background: var(--green); color:#fff; }
    .active-off { background: #444; color:#aaa; }
    tr.deactivated { opacity: 0.3; }

    /* Casting Mode */
    .hide-ui { display: none !important; }
    #showSettingsBtn { display:none; position:fixed; top:10px; right:10px; background:var(--green); z-index:1000; }
    
    #import-area { width:100%; height:60px; background:#1a1a1a; color:#0f0; border:1px solid #333; padding:8px; font-size:12px; margin-bottom:10px; border-radius:4px; }
    .metrics { background:#222; padding:12px; border-radius:8px; margin-bottom:15px; display:flex; gap:20px; font-size:14px; }
  </style>
</head>
<body>

<button id="showSettingsBtn" class="btn" onclick="toggleSettings(false)">SHOW SETTINGS</button>

<div id="admin">
  <div class="header">
    <span>BGMI DUAL PRODUCTION: ELEMANTX x GRAVIX</span>
    <span id="stMsg" class="status-msg">READY</span>
  </div>

  <div class="metrics">
    <div>SENT SLOT: <span id="mWin" style="color:var(--blue)">-</span></div>
    <div>BUFFER: <span id="key-buffer" style="color:var(--orange)">NONE</span></div>
  </div>

  <div class="settings-area">
    <textarea id="import-area" placeholder="Format: 1 | TEAM NAME (Naye teams yahan paste karein)"></textarea>
    <div class="top-controls">
        <button class="btn" style="background:#333" onclick="importSlots()">IMPORT LIST</button>
        <button class="btn" style="background:var(--blue)" onclick="window.open('view.html','_blank')">OPEN OVERLAY</button>
        <button class="btn" style="background:var(--red)" onclick="toggleSettings(true)">START CASTING (HIDE SETTINGS)</button>
    </div>
  </div>

  <table class="db-table">
    <thead>
      <tr>
        <th>SLOT</th>
        <th>STATUS</th>
        <th>SEND</th>
        <th class="settings-area">TEAM NAME</th>
        <th class="settings-area">LOGO (URL/TEXT)</th>
        <th class="settings-area">BG COLOR</th>
      </tr>
    </thead>
    <tbody id="dbBody"></tbody>
  </table>
</div>

<script>
  const FIREBASE_URL = "https://bgmi-overlay-default-rtdb.firebaseio.com/liveData.json";
  let teamDB = JSON.parse(localStorage.getItem('bgmi_v23_db') || '{}');
  let activeSlots = JSON.parse(localStorage.getItem('bgmi_active_map') || '[]');
  if(activeSlots.length === 0) activeSlots = Array(26).fill(true);

  let inputBuffer = "";
  let bufferTimeout = null;

  function renderTable(){
    const tb = document.getElementById('dbBody');
    tb.innerHTML = "";
    for(let i=1;i<=25;i++){
      if(!teamDB[i]) teamDB[i]={name:`TEAM ${i}`,logo:`${i}`,sbg:(i==4||i==13?'#2ecc71':'#ff4500')};
      const t = teamDB[i];
      const on = activeSlots[i];
      
      tb.innerHTML += `
        <tr id="row-${i}" class="${on ? '' : 'deactivated'}">
          <td style="font-size:18px; font-weight:bold; color:var(--orange)">${i}</td>
          <td><button class="toggle-btn ${on?'active-on':'active-off'}" onclick="toggleActive(${i})">${on?'ACTIVE':'OFF'}</button></td>
          <td><button class="manual-show" onclick="sendSlot(${i})">${i}</button></td>
          <td class="settings-area"><input value="${t.name}" onchange="updateDB(${i},'name',this.value)"></td>
          <td class="settings-area"><input value="${t.logo}" onchange="updateDB(${i},'logo',this.value)"></td>
          <td class="settings-area"><input type="color" value="${t.sbg}" onchange="updateDB(${i},'sbg',this.value)"></td>
        </tr>`;
    }
  }

  function toggleActive(i){ activeSlots[i] = !activeSlots[i]; localStorage.setItem('bgmi_active_map', JSON.stringify(activeSlots)); renderTable(); }
  function updateDB(i,k,v){ teamDB[i][k]=v; localStorage.setItem('bgmi_v23_db',JSON.stringify(teamDB)); }

  function importSlots(){
    const text=document.getElementById('import-area').value;
    text.split('\n').forEach(line=>{
      const m=line.match(/(\d+)\s*[|•-]\s*(.+)/);
      if(m){
        const slot = parseInt(m[1]);
        if(slot>=1 && slot<=25) teamDB[slot].name = m[2].trim();
      }
    });
    localStorage.setItem('bgmi_v23_db',JSON.stringify(teamDB)); renderTable();
  }

  function toggleSettings(hide){
    document.querySelectorAll('.settings-area').forEach(el => el.classList.toggle('hide-ui', hide));
    document.getElementById('showSettingsBtn').style.display = hide ? 'block' : 'none';
  }

  function sendSlot(slot){
    if(!activeSlots[slot]) return;
    const t = teamDB[slot];
    const payload = {slot, name:t.name, logo:t.logo, sbg:t.sbg, ts:Date.now()};
    localStorage.setItem('bgmi_v23_push', JSON.stringify(payload));
    fetch(FIREBASE_URL,{method:"PUT",body:JSON.stringify(payload)});
    document.getElementById('mWin').textContent = slot;
    document.getElementById('stMsg').textContent = `✅ LIVE: ${t.name}`;
  }

  window.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    if (e.key >= '0' && e.key <= '9') {
      clearTimeout(bufferTimeout);
      inputBuffer += e.key;
      document.getElementById('key-buffer').textContent = inputBuffer;
      bufferTimeout = setTimeout(() => {
        const slot = parseInt(inputBuffer);
        if (slot >= 1 && slot <= 25 && activeSlots[slot]) sendSlot(slot);
        inputBuffer = ""; document.getElementById('key-buffer').textContent = "NONE";
      }, 500); 
    }
  });

  renderTable();
</script>
</body>
</html>
